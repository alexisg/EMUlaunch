// ========================================================================================// DISPLAY FIRST LIST ITEM and Background PIC// ========================================================================================function liststart() {	_focusrect = false;	tree.sortItemsBy("label", "ASC");	tree.refresh();	tree.setFocus();	tree.vPosition = 0;	tree.setSelectedIndex(0);	//!*** On change function from above does not fire when the first selection occurs, so we have to force the display of the pictures and titles.	noextension = tree.getItemAt(0).attributes.label;	textbox.text = noextension;	file = tree.getItemAt(0).attributes.rom;	filesans = file.substring(0, file.indexOf(".zip"));	isdir = tree.getItemAt(0).attributes.type;	//LOAD MAIN SCREENSHOT	if (pick == 15) {		if (mFile.fileExists(picroot+filesans+".png")) {			loader.load(picroot+filesans+".png");			loaderR.load(picroot+filesans+".png");		} else if (mFile.fileExists(picroot+filesans+".jpg")) {			loader.load(picroot+filesans+".jpg");			loaderR.load(picroot+filesans+".jpg");		} else if (mFile.fileExists(mSystem.getSpecialFolder("LIBRARY")+"/Application Support/MAME OS X/Screenshots/" + filesans +"/0000.png")) {			loader.load(mSystem.getSpecialFolder("LIBRARY")+"/Application Support/MAME OS X/Screenshots/" + filesans +"/0000.png");			loaderR.load(mSystem.getSpecialFolder("LIBRARY")+"/Application Support/MAME OS X/Screenshots/" + filesans +"/0000.png");			//mApplication.trace("Look for MAME OS X file" + mSystem.getSpecialFolder("LIBRARY")+"/Application Support/MAME OS X/Screenshots/" + filesans +"/0000.png");			} else if (isdir == 1) {			loader.load("folder.swf");			loaderR.load("folder.swf");		} else {			loader.load("blank.png");			loaderR.load("blank.png");		}	} else {		if (mFile.fileExists(picroot+noextension+".png")) {			loader.load(picroot+noextension+".png");			loaderR.load(picroot+noextension+".png");		} else if (mFile.fileExists(picroot+noextension+".jpg")) {			loader.load(picroot+noextension+".jpg");			loaderR.load(picroot+noextension+".jpg");		} else if (isdir == 1) {			loader.load("folder.swf");			loaderR.load("folder.swf");		} else {			loader.load("blank.png");			loaderR.load("blank.png");		}	}		//LOAD 2ND SCREENSHOT		if (pick == 15) {			if (mFile.fileExists(picroot2+filesans+".png")) {				loader2.load(picroot2+filesans+".png");			} else if (mFile.fileExists(picroot2+filesans+".jpg")) {				loader2.load(picroot2+filesans+".jpg");			} else if (isdir == 1) {				loader2.load("blank.png");			} else {				loader2.load("blank.png");			}		} else {			if (mFile.fileExists(picroot2+noextension+".png")) {				loader2.load(picroot2+noextension+".png");			} else if (mFile.fileExists(picroot2+noextension+".jpg")) {				loader2.load(picroot2+noextension+".jpg");			} else if (isdir == 1) {				loader2.load("blank.png");			} else {				loader2.load("blank.png");			}		}				//Display name of console	textboxtitle.text = _global.consolename;	// Starts loading of all bg pics and calls button pick dock tweening which then calls loadbgpic	setTimeout(buttonpick,200);	_global.lastbgpic = bgpic;}// ========================================================================================// Chooses function to build list. If MAME load PHP created XML file, else use MPorjector to create xml file// ========================================================================================function listbuildchoose() {	tree.removeAll();	function listFiles(dir:String, retData) {		// ========================================================================================		// First list the folders		// ========================================================================================		var folders:Array = mFile.listFolders(dir);		for (var i:Number = 0; i<folders.length; i++) {			retData += "<folder type=\"1\" label=\""+folders[i]+"\">";			retData = listFiles(dir+"/"+folders[i], retData);			retData += "</folder>";		}		// ========================================================================================		// And then the files		// ========================================================================================		var files:Array = mFile.listFiles(dir);		//mApplication.trace("Directory: "+dir+" File #: "+files.length);		for (var i:Number = 0; i<files.length; i++) {			if (files[i] != ".DS_Store") {				if ((files[i].endsWith(".gz") == true) or (files[i].endsWith(".vb") == true) or (files[i].endsWith(".gg") == true) or (files[i].endsWith(".st") == true) or (files[i].endsWith(".gb") == true)) {					newfilename = files[i].slice(0, -3);				} else {					newfilename = files[i].slice(0, -4);				}				retData += "<node type=\"0\" label=\""+newfilename+"\" rom=\""+files[i]+"\" dir=\""+dir+"\" />";			}		}		return (retData);	}	// ========================================================================================	// If MAME load PHP created XML file	// ========================================================================================	if (pick == 15) {		var newmame_xml:XML = new XML();		newmame_xml.ignoreWhite = true;		newmame_xml.onLoad = function(success:Boolean) {			tree.dataProvider = newmame_xml;			liststart();		};		newmame_xml.load(workingDirectory+"/EMUlaunch-mame.xml");	} else {		p = pick-1;		var dirData:XML = new XML();		dirData.ignoreWhite = true;		dirData.onLoad = function() {			tree.dataProvider = this.childNodes[p];			liststart();		};		dirData.load(workingDirectory+"/EMUlaunch-games.xml");	}// <--< END IF ELSE}function buildlist() {	p = pick-1;	_global.game = game_xml.childNodes[p].childNodes;	_global.consolename = game_xml.childNodes[p].attributes.title;	_global.folderName = game_xml.childNodes[p].attributes.root;	_global.picroot = game_xml.childNodes[p].attributes.picroot;	_global.picroot2 = game_xml.childNodes[p].attributes.picroot2;	_global.bgpic = game_xml.childNodes[p].attributes.bgpic;	_global.active = game_xml.childNodes[p].attributes.active;	// ========================================================================================	// TEST to see if this console is ACTIVE (one of the consoles the user has selected in the config).	// If it is call listbuildchoose().  If not incremet the pick and send it on its merry way	// ========================================================================================	if (active == "false") {		// ================================================		// pick logic for making sure pick is never over 15		// ================================================		if (lastpick>pick) {			if (pick == 1 && lastpick == maxconsoles) {				_global.lastpick = pick;				launchconsole(2);			} else if (pick == 1) {				_global.lastpick = pick;				launchconsole(maxconsoles);			} else {				_global.lastpick = pick;				launchconsole(pick-1);			}		} else if (lastpick<pick) {			if (pick == maxconsoles && lastpick == 1) {				_global.lastpick = pick;				launchconsole(maxconsoles-1);			} else if (pick == maxconsoles) {				_global.lastpick = pick;				launchconsole(1);			} else {				_global.lastpick = pick;				launchconsole(pick+1);			}		} //<--< END PICK LOGIC	} else if (pick == lastpick) {		// =======================================================================		// Don't do anything if user already has this same exact console loaded up		// =======================================================================	} else {		// *******************************************		// LIST BUILD CHOOSE ACTUALLY BUILDS THE LISTS		// *******************************************		listbuildchoose();	} // <--< END IF ACTIVE CHECK	var xml_lastrun:String = "<lastpick emulaunchversion=\"12\" build=\"1.2\" pick=\""+pick+"\" />";	mFile.writeString(workingDirectory+"/EMUlaunch-lastrun.xml", xml_lastrun);}// <!-- END BUILD LIST